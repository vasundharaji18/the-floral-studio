{% extends "index.html" %}
{% block content %}
<div class="max-w-3xl mx-auto p-6 bg-white shadow rounded text-center">
    <h2 class="text-2xl font-bold mb-4">Checkout Payment</h2>
    <p class="mb-2">Order ID: {{ order.id }}</p>
    <p class="mb-2">Total Amount: ₹{{ grand_total }}</p>

    <!-- Pay Button -->
    <button id="rzp-button" 
        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg">
        Pay with Razorpay
    </button>
</div>

<!-- Razorpay JS -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    var options = {
        "key": "{{ razorpay_key_id }}",  // settings se key
        "amount": "{{ grand_total|floatformat:2|add:'0'|floatformat:0 }}00", // paise me
        "currency": "INR",
        "name": "The Floral Studio",
        "description": "Order #{{ order.id }}",
        "order_id": "{{ razorpay_order_id }}",  // backend se generate hua order
        "handler": function (response){
            // ✅ success hone ke baad redirect
            window.location.href = "/payment/success/?order_id={{ order.id }}&amount={{ grand_total }}&payment_id=" + response.razorpay_payment_id;
        },
        "prefill": {
            "email": "{{ user_email }}",
            "contact": "{{ user_phone }}"
        },
        "theme": {
            "color": "#3399cc"
        }
    };

    var rzp1 = new Razorpay(options);
    document.getElementById('rzp-button').onclick = function(e){
        rzp1.open();
        e.preventDefault();
    }
</script>
{% endblock %}
